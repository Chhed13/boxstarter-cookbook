$module_dir = Get-ChildItem -Path $env:SystemDrive\Users\*\Appdata\Roaming\Boxstarter -filter Boxstarter.Chocolatey -Recurse -Directory
Import-Module "$($module_dir.FullName)\Boxstarter.Chocolatey.psd1"
$identity = [System.Security.Principal.WindowsIdentity]::GetCurrent()
$plain_password = '<%= @password %>'
$disable_reboots = <%= @disable_reboots %>

if($plain_password.length -gt 0) {
	$password = ConvertTo-SecureString $plain_password -asplaintext -force
	$creds = New-Object System.Management.Automation.PSCredential ($identity.Name, $password)
}

$params = @{
	PackageName = "<%= @temp_dir %>/package.ps1"
}
if($creds){$params['credential'] = $creds}
if($disable_reboots){$params['DisableReboots'] = $true}
Install-BoxstarterPackage @params -verbose